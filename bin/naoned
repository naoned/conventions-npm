#!/usr/bin/env node
'use strict';

var jsonfile = require('jsonfile');
var merge = require('merge');
var sh = require('shelljs');
var args = process.argv.slice(2, process.argv.length);

if(args[0] === 'init-git' && args.length === 1) {
	var file = process.cwd() + '/package.json';
	var defaultSettings = {
		"config": {
			"commitizen": {
				"path": "./node_modules/naoned-conventions-npm/node_modules/naoned-cz-conventional-changelog"
			},
			"ghooks": {
				"commit-msg": "validate-commit-msg"
			},
			"validate-commit-msg": {
				"types": ["feat", "fix", "docs", "style", "refact", "perf", "test", "misc", "revert"],
				"warnOnFail": false,
				"maxSubjectLength": 100
			}
		}
	};
	jsonfile.readFile(file, function(err, obj) {
		if(err) {
			sh.echo('No package.json? run npm init');
		} else {
			jsonfile.writeFile(file, merge.recursive(true, obj, defaultSettings), {spaces: 2}, function (err) {
				if(err === null) {
					sh.cd(process.cwd());
					sh.exec('npm i --save ghooks validate-commit-msg');
				} else {
					sh.echo(err);
				}
			});
		}
	});
}
